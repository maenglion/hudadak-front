<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <title>설정 · HUDADAK</title>

  <meta name="color-scheme" content="light dark">
  <meta name="theme-color" content="#ffffff" id="meta-theme-color">

  <link rel="stylesheet" href="../styles.css">
  <style>
    /* Settings-specific styles */
    :root {
      --safe-top: env(safe-area-inset-top, 0px);
    }
    body {
      padding-top: var(--safe-top);
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: 'Noto Sans KR', sans-serif;
    }
    main {
      padding: 1rem;
    }
    .settings-topbar {
      position: sticky;
      top: var(--safe-top);
      z-index: 10;
      display: flex;
      align-items: center;
      padding: 0 0.5rem;
      height: 56px;
      border-bottom: 1px solid var(--border-color);
      background-color: color-mix(in srgb, var(--bg-color) 85%, transparent);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .settings-topbar h1 {
      font-size: 1.1rem;
      font-weight: 600;
      margin: 0;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }
    .settings-section {
      margin-top: 2.5rem;
      margin-bottom: 2.5rem;
    }
    .settings-section h2 {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 1rem;
      border-left: 4px solid var(--primary-color);
      padding-left: 0.75rem;
    }
    .radio-group label {
      display: flex;
      align-items: center;
      background-color: var(--card-bg);
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 0.75rem;
      border: 2px solid var(--border-color);
      cursor: pointer;
      transition: all 0.2s ease-in-out;
    }
    .radio-group label:hover {
      border-color: var(--primary-color);
    }
    .radio-group label:has(input:checked) {
      border-color: var(--primary-color);
      background-color: color-mix(in srgb, var(--primary-color) 10%, var(--card-bg));
      box-shadow: 0 4px 12px color-mix(in srgb, var(--primary-color) 15%, transparent);
    }
    .radio-group input {
      margin-right: 0.75rem;
    }
    .section-description {
      font-size: 0.9rem;
      color: var(--subtle-text-color);
      margin-top: 0.5rem;
      padding: 0.75rem 1rem;
      background-color: color-mix(in srgb, var(--subtle-text-color) 8%, transparent);
      border-radius: 8px;
    }
    .data-story p {
        line-height: 1.7;
        font-size: 0.95rem;
    }
    .badge-info {
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
        margin-top: 1rem;
    }
    .badge-example {
        flex-shrink: 0;
        margin-top: 2px;
        padding: 0.25rem 0.6rem;
        border-radius: 99px;
        font-size: 0.8rem;
        font-weight: 500;
        border: 1px solid var(--border-color);
        background-color: var(--bg-color);
    }
    .icon-button {
        width: 44px; height: 44px; border: none; background: none; color: var(--text-color);
        cursor: pointer; display: grid; place-items: center; border-radius: 50%;
    }
    .icon-button svg {
      width: 24px;
      height: 24px;
    }
    footer {
        padding: 2rem 0;
    }
  </style>
</head>
<body>
  <header class="settings-topbar">
    <button id="close-settings-btn" class="icon-button" aria-label="설정 닫기">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10.586 12L3.293 4.707a1 1 0 1 1 1.414-1.414L12 10.586l7.293-7.293a1 1 0 1 1 1.414 1.414L13.414 12l7.293 7.293a1 1 0 1 1-1.414 1.414L12 13.414l-7.293 7.293a1 1 0 1 1-1.414-1.414L10.586 12z"/></svg>
    </button>
    <h1>설정</h1>
  </header>

  </main>

  <script type="module">
    // This script is now inside the iframe (setup/index.html)
    import { STANDARDS } from '../js/standards.js';

    // --- DOM Elements ---
    const standardOptions = document.getElementById('standard-options');
    const standardDescription = document.getElementById('standard-description');
    const closeBtn = document.getElementById('close-settings-btn');
    const AQI_STANDARD_KEY = 'aq_standard';

    const descriptions = {
      KOR: '대한민국 환경부의 통합대기환경지수(CAI) 4단계(좋음/보통/나쁨/매우나쁨) 기준으로 표시합니다.',
      WHO8: '세계보건기구(WHO)의 2021년 권고 기준을 8단계로 세분화하여 더욱 정밀하게 표시합니다.',
    };

    // --- Functions ---
    function updateDescription(standard) {
      standardDescription.textContent = descriptions[standard] || '';
    }

    function handleStandardChange(event) {
      const selectedStandard = event.target.value;
      localStorage.setItem(AQI_STANDARD_KEY, selectedStandard);
      updateDescription(selectedStandard);
      
      // Notify the parent window (main app) that the standard has changed
      window.parent?.postMessage({ type:'standardChanged', value: nextValue }, '*');
    }
    
    // --- Event Listeners ---
    standardOptions.addEventListener('change', handleStandardChange);
    
    closeBtn.addEventListener('click', () => {
      // Send a message to the parent window to close the panel
 window.parent?.postMessage({ type:'closeSettings' }, '*');

    });

    // --- Initialization ---
    const currentStandard = localStorage.getItem(AQI_STANDARD_KEY) || 'KOR';
    const currentRadio = standardOptions.querySelector(`input[value="${currentStandard}"]`);
    if (currentRadio) {
      currentRadio.checked = true;
    }
    updateDescription(currentStandard);

  </script>

</body>
</html>

